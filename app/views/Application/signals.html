#{extends 'main.html' /}
#{set title:'Home' /}

<div id="signals"></div>

<script>
$(function() {
    function getUser(){
        return window.sessionStorage.user;
    }
    function getPwd(){
        return window.sessionStorage.pwd;
    }

    $.ajax({
		url: 'SocialText/signals?user='+encodeURIComponent(getUser())+'&pwd='+encodeURIComponent(getPwd()),
		success: function(data) {
			for(var i = 0; i < data.length; ++i) {
			    $.mobile.hidePageLoadingMsg();

				var photoDiv = '<div class="photo"><img src="SocialText/photo?user='+encodeURIComponent (getUser())+'&pwd='+encodeURIComponent(getPwd())+'&userId='+ data[i].user_id +'"/></div>';
				var contentDiv = '<div class="content">'+ data[i].body +'</div>';
				var authorDiv = '<div class="author">Author: ' + data[i].best_full_name + '</div>';
				var timestampDiv = '<div class="timestamp">'+ configureTimestamp(data[i].at) +'</div>';
				//var timestampDiv = '<div class="timestamp">'+ data[i].at +'</div>';
				var signalDiv = $('<div class="signal" />').append(photoDiv).append(contentDiv).append(authorDiv).append(timestampDiv);
				
				$("#signals").append(signalDiv);
				console.log(data[i]);
			}
		}
	});
    
    $.mobile.showPageLoadingMsg();
})

function configureTimestamp(timestamp)
{
	var result = "gepost op ";
	
	result += timestamp.substring(0, 9);
	result += " om ";
	result += timestamp.substring(11,16);
	
	return result;
}
</script>
